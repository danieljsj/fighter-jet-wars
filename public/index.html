<!DOCTYPE html>
<html>
<head></head>
<body>
  <canvas id="myCanvas" width='800' height='800'></canvas>





<script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyB0wRqUQWX0nfOl7TC8ydGgs0MGXnLJ_9Y",
    authDomain: "fighter-jets.firebaseapp.com",
    databaseURL: "https://fighter-jets.firebaseio.com",
    storageBucket: "fighter-jets.appspot.com",
  };
  firebase.initializeApp(config);
  // old "rules": {
  //   ".read": "auth != null",
  //   ".write": "auth != null"
  // }
</script>






<script>

var p1Ref = firebase.database().ref("players/1")

p1Ref.on('value', function(snapshot){
	// console.log(snapshot.val());
	//SOON:
	// tickX = snapshot.p.x;
	// tickY = snapshot.p.y;
	//TEMP:
	tickX = tickX + snapshot.val().controls.turningRight - snapshot.val().controls.turningLeft;
	tickY = tickY - snapshot.val().controls.accellerating + snapshot.val().controls.braking;
});

</script>










<script>

// http://paulirish.com/2011/requestanimationframe-for-smart-animating/
// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
 
// requestAnimationFrame polyfill by Erik MÃ¶ller
// fixes from Paul Irish and Tino Zijdel
 
(function() {
    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame']
                                   || window[vendors[x]+'CancelRequestAnimationFrame'];
    }
 
    if (!window.requestAnimationFrame)
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); },
              timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
 
    if (!window.cancelAnimationFrame)
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
}());




//event listener
window.addEventListener("keydown", onKeyDown, false);
window.addEventListener("keyup", onKeyUp, false);

function onKeyDown(event) {
  var keyCode = event.keyCode;
  switch (keyCode) {
    case 87: //w
      p1Ref.child('controls/accellerating').set(1);
      break;
    case 83: //s
      p1Ref.child('controls/braking').set(1);
      break;
    case 65: //a
      p1Ref.child('controls/turningLeft').set(1);
      break;
    case 68: //d      
      p1Ref.child('controls/turningRight').set(1);
      break;
  }
}

function onKeyUp(event) {
  var keyCode = event.keyCode;

  switch (keyCode) {
    case 87: //w
      p1Ref.child('controls/accellerating').set(0);
      break;
    case 83: //s
      p1Ref.child('controls/braking').set(0);
      break;
    case 65: //a
      p1Ref.child('controls/turningLeft').set(0);
      break;
    case 68: //d      
      p1Ref.child('controls/turningRight').set(0);
      break;
  }
}

//neccessary variables
var tickX = 10;
var tickY = 10;


//main animation function
function drawStuff() {
  window.requestAnimationFrame(drawStuff);
  var canvas = document.getElementById("myCanvas");
  var c = canvas.getContext("2d");

  c.clearRect(0, 0, 800, 800);
  c.fillStyle = "blue";
  c.fillRect(tickX, tickY, 100, 100);

}
window.requestAnimationFrame(drawStuff);

</script>








</body>
</html>